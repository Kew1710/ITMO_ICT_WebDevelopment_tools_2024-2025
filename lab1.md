# Лабораторная работа 1. Сервис управления личными финансами на FastAPI

> Простой сервис для управления личными финансами: ввод доходов и расходов, бюджеты по категориям, отчёты и работа с пользователями.

## Содержание

* [Цель работы](#цель-работы)
* [Модель данных](#модель-данных)
* [Структура проекта](#структура-проекта)
* [Настройка и запуск](#настройка-и-запуск)
* [API и CRUD-операции](#api-и-crud-операции)
* [Миграции Alembic](#миграции-alembic)
* [Аутентификация и JWT](#аутентификация-и-jwt)
* [Тестирование](#тестирование)

---

## Цель работы

* Создать сервис, позволяющий:

  * Вводить доходы и расходы
  * Устанавливать бюджеты по категориям
  * Просматривать отчёты транзакций
* Реализовать пользовательский функционал:

  * Регистрация и авторизация
  * Генерацию и проверку JWT
  * Смену пароля

## Модель данных

* **Пользователь** (`User`)
* **Категория** (`Category`)
* **Транзакция** (`Transaction`)
* **Бюджет** (`Budget`)
* **Ассоциация** `TransactionCategory` (many-to-many с полем `amount`)

Связи:

* `User 1:M Transaction`
* `User 1:M Budget`
* `Transaction M:N Category` через `TransactionCategory`

## Структура проекта

```bash
lab1/
├─ app/
│  ├─ main.py              # Точка входа FastAPI
│  ├─ models.py            # ORM-модели SQLModel/SQLAlchemy
│  ├─ schemas.py           # Pydantic-схемы
│  ├─ crud.py              # Функции работы с БД
│  ├─ api/
│  │  ├─ transactions.py   # Роуты транзакций
│  │  ├─ budgets.py        # Роуты бюджетов
│  │  └─ users.py          # Роуты пользователей
│  └─ utils.py             # JWT, хэширование паролей
├─ alembic/
│  └─ versions/            # Скрипты миграций
├─ requirements.txt        # Зависимости проекта
└─ README.md               # Инструкция по запуску
```

## Настройка и запуск

1. **Виртуальное окружение**

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. **Переменные окружения**

   ```bash
   export DATABASE_URL=postgresql://user:pass@localhost:5432/finances
   export JWT_SECRET=YOUR_SECRET_KEY
   ```
3. **Миграции**

   ```bash
   alembic upgrade head
   ```
4. **Запуск приложения**

   ```bash
   uvicorn app.main:app --reload
   ```
5. **Документация**
   Открыть Swagger UI: `http://127.0.0.1:8000/docs`

## API и CRUD-операции

| Сущность     | Эндпоинты                                                           | Описание                             |
| ------------ | ------------------------------------------------------------------- | ------------------------------------ |
| Пользователи | `GET /users`, `POST /users`                                         | Регистрация, список пользователей    |
|              | `POST /auth/login`                                                  | Логин и получение JWT                |
| Транзакции   | `GET /transactions`, `POST /transactions`, `GET /transactions/{id}` | CRUD транзакций, вложенные категории |
| Бюджеты      | `GET /budgets`, `POST /budgets`                                     | CRUD бюджетов                        |

## Миграции Alembic

* Скрипты находятся в папке `alembic/versions`
* Для создания новой миграции:

  ```bash
  alembic revision --autogenerate -m "Добавить таблицу X"
  ```

## Аутентификация и JWT

* Генерация токена при логине (`/auth/login`)
* Проверка токена через зависимость FastAPI
* Хэширование паролей с использованием `bcrypt`


*Следующий шаг: подробное описание ЛР2 в `docs/lab2.md`*
